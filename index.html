<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>InkLoom Dashboard</title>
  <style>
    /* General reset */
    * { margin:0; padding:0; box-sizing:border-box; font-family: 'Poppins', sans-serif; }
    body { background:#f9f9f9; color:#333; }

    /* Navbar */
    .navbar { display:flex; justify-content:space-between; align-items:center; padding:1rem 2rem; background:#2e7d32; color:white; }
    .navbar a { color:white; text-decoration:none; margin-left:1rem; }
    .navbar a:hover { text-decoration:underline; }

    /* Main Container */
    .container { max-width:900px; margin:2rem auto; background:white; padding:2rem; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1); }

    /* Profile */
    .profile { display:flex; align-items:center; gap:1.5rem; margin-bottom:2rem; }
    .avatar { width:100px; height:100px; border-radius:50%; object-fit:cover; }
    .profile-info input, .profile-info textarea { display:block; width:100%; padding:0.5rem; margin:0.5rem 0; border-radius:6px; border:1px solid #ccc; }
    .profile-info button { padding:0.5rem 1rem; background:#2e7d32; color:white; border:none; border-radius:6px; cursor:pointer; }

    /* Books List */
    .books { margin-top:2rem; }
    .book-item { display:flex; justify-content:space-between; padding:0.75rem 1rem; background:#e8f5e9; margin:0.5rem 0; border-radius:6px; }
    .book-item button { padding:0.25rem 0.5rem; border:none; border-radius:4px; background:#2e7d32; color:white; cursor:pointer; }

    /* Dashboard Visibility */
    #authContainer { display:block; }
    #dashboard { display:none; }

    /* Auth Form */
    .auth-form { max-width:400px; margin:2rem auto; background:white; padding:2rem; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1); }
    .auth-form input, .auth-form button { width:100%; padding:0.5rem; margin:0.5rem 0; border-radius:6px; border:1px solid #ccc; }
    .auth-form button { background:#2e7d32; color:white; border:none; cursor:pointer; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <div class="navbar">
    <div class="logo">InkLoom</div>
    <div id="navLinks">
      <a href="#" id="loginLink">Login / Sign Up</a>
      <a href="#" id="logoutLink" style="display:none;">Logout</a>
    </div>
  </div>

  <!-- Authentication Container -->
  <div class="auth-form" id="authContainer">
    <h2>Sign Up</h2>
    <input id="su_email" type="email" placeholder="Email" />
    <input id="su_pass" type="password" placeholder="Password" />
    <button onclick="signUp()">Sign Up</button>

    <h2>Log In</h2>
    <input id="li_email" type="email" placeholder="Email" />
    <input id="li_pass" type="password" placeholder="Password" />
    <button onclick="logIn()">Log In</button>

    <button onclick="forgotPassword()">Forgot Password?</button>
  </div>

  <!-- Dashboard -->
  <div class="container" id="dashboard">
    <div class="profile">
      <img id="avatarImg" class="avatar" src="" alt="avatar" />
      <div class="profile-info">
        <input id="avatarUrl" placeholder="Avatar URL" />
        <input id="username" placeholder="Username" />
        <textarea id="bio" placeholder="Bio"></textarea>
        <button onclick="saveProfile()">Save Profile</button>
      </div>
    </div>

    <div class="books">
      <h3>Your Saved Books</h3>
      <div id="savedBooksList"></div>
      <input id="bookName" placeholder="Book Title" />
      <button onclick="saveBook()">Add Book</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendPasswordResetEmail, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_BUCKET",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Auth Functions
    window.signUp = async function() {
      try {
        const email = document.getElementById('su_email').value;
        const pass = document.getElementById('su_pass').value;
        await createUserWithEmailAndPassword(auth, email, pass);
        alert("Account created!");
      } catch(e) { alert(e.message); }
    };

    window.logIn = async function() {
      try {
        const email = document.getElementById('li_email').value;
        const pass = document.getElementById('li_pass').value;
        await signInWithEmailAndPassword(auth, email, pass);
        alert("Logged in!");
      } catch(e) { alert(e.message); }
    };

    window.forgotPassword = async function() {
      try {
        const email = document.getElementById('li_email').value;
        await sendPasswordResetEmail(auth, email);
        alert("Password reset email sent!");
      } catch(e) { alert(e.message); }
    };

    window.logOut = function() {
      signOut(auth);
    };

    window.saveProfile = async function() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      await setDoc(ref, {
        username: document.getElementById('username').value,
        bio: document.getElementById('bio').value,
        avatar: document.getElementById('avatarUrl').value
      }, { merge: true });
      alert("Profile updated!");
      loadProfile(user);
    };

    window.saveBook = async function() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const bookName = document.getElementById('bookName').value;
      if(bookName) {
        await updateDoc(ref, { savedBooks: arrayUnion(bookName) });
        loadBooks();
        document.getElementById('bookName').value = '';
      }
    };

    async function loadProfile(user) {
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        const d = snap.data();
        document.getElementById('avatarImg').src = d.avatar || "";
        document.getElementById('username').value = d.username || "";
        document.getElementById('bio').value = d.bio || "";
      }
    }

    async function loadBooks() {
      const user = auth.currentUser;
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      const list = document.getElementById('savedBooksList');
      list.innerHTML = "";
      if (snap.exists() && snap.data().savedBooks) {
        snap.data().savedBooks.forEach((b, i) => {
          const div = document.createElement("div");
          div.className = "book-item";
          div.innerHTML = `<span>${b}</span> <button onclick='markRead(${i})'>Mark Read</button>`;
          list.appendChild(div);
        });
      }
    }

    window.markRead = async function(index) {
      alert(`Book ${index+1} marked as read! (You can integrate progress tracking here)`);
    };

    // Auth State Observer
    onAuthStateChanged(auth, (user) => {
      const authContainer = document.getElementById('authContainer');
      const dashboard = document.getElementById('dashboard');
      const loginLink = document.getElementById('loginLink');
      const logoutLink = document.getElementById('logoutLink');

      if (user) {
        authContainer.style.display = "none";
        dashboard.style.display = "block";
        loginLink.style.display = "none";
        logoutLink.style.display = "inline-block";
        loadProfile(user);
        loadBooks();
      } else {
        authContainer.style.display = "block";
        dashboard.style.display = "none";
        loginLink.style.display = "inline-block";
        logoutLink.style.display = "none";
      }
    });
  </script>
</body>
</html>
